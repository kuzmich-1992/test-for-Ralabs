<html>
<head>   
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/pbkdf2.js"></script>
</head>

  <form action="http://localhost:3000/messages#create" method="post">
  <div>
    <p>Enter text</p>
    <input id="text" type="text" name="text" />
    <p>Enter pasword</p>
    <input id="password_text" type="text" name="text" />
    
    <input type="hidden" id="password" name="password" value="">
    <input type="hidden" id="transit_message" name="transit_message" value="">
    <button>Send</button>
  </div>
  </form>


  <script>

  var keySize = 256;
  var ivSize = 128;
  var iterations = 100;
  
  var message = document.querySelector("#text").value ;

  var password = document.querySelector("#password_text").value ;


  function encrypt (msg, pass) {

  var salt = CryptoJS.lib.WordArray.random(128/8);
  
  var key = CryptoJS.PBKDF2(pass, salt, {
      keySize: keySize/32,
      iterations: iterations
    });

  var iv = CryptoJS.lib.WordArray.random(128/8);

  var encrypted = CryptoJS.AES.encrypt(msg, key, { 
    iv: iv, 
    padding: CryptoJS.pad.Pkcs7,
    mode: CryptoJS.mode.CBC
    
  });

  var transitmessage = salt.toString()+ iv.toString() + encrypted.toString();
  document.getElementById("transit_message").value = transitmessage;
  
  };

  var encrypted = encrypt(message, password);
  document.getElementById("password").value = encrypted;

  </script>



</html>
