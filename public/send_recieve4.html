<html>
  <head> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
  </head>
  
  <div>
    <h4>send</h4>
    <p>Enter text</p>
    <input id="text" type="text" name="text" />
    <p>Enter pasword</p>
    <input id="passcode" type="text" name="text" />
    <button id="encbutton" >Encrypt</button>
    <p>encrypted message for send</p>
    <div id="encrypted"></div>
    <br>
    <button id="sendbutton" >SEND</button>
  </div>
  
  <br>
  <h4>recieve</h4>
  <br>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>

  <p> enter id of message</p>
  <input id="idInput" type="text" size="20">
  <button id="idbutton">submit</button>
  <br>
  <p>encrypted message</p>
  <div id="pass"></div>
  <p>enter password</p>
  <input id="passInput" type="text" size="20">
  <button id="passbutton">show message</button>
  <input type="hidden" id="enc" name="password" value="">
  <p>decrypted message</p>
  <div id="decrypted"></div>

<script>

$(document).ready(function(){
  $("#encbutton").click(function(){
      var code = (function(){
        return{
          encryptMessage: function(messageToencrypt = '', secretkey = ''){
            var encryptedMessage = CryptoJS.AES.encrypt(messageToencrypt, secretkey);
              return encryptedMessage.toString();
          },
        }
      })();

        var message = $("#text").val(); 
        var key = $("#passcode").val();
        var encrypted = code.encryptMessage(message,key);
        $("#encrypted").append(encrypted);
        var data = encrypted ;

  $("#sendbutton").click(function(){
    $.ajax({
      url: 'https://ralabs-test.herokuapp.com/messages#create',
      type: "POST",
      data: { text: data } ,
      dataType: 'json',
      }).done(function (data){
        
      });

    });

  });

});


$(document).ready(function(){
  $("#idbutton").click(function(){
    var id = document.getElementById("idInput").value;
    $.ajax({
      url: "https://ralabs-test.herokuapp.com/messages/" + id,
      type: "GET",
      dataType: 'json',
      }).done(function(data) {
      
      $("#pass").append(JSON.stringify(data.text));
    });
  });

  $("#passbutton").click(function(){
    var code = (function(){
      return{
        decryptMessage: function(encryptedMessage = '', secretkey = ''){
          var decryptedBytes = CryptoJS.AES.decrypt(encryptedMessage, secretkey);
          var decryptedMessage = decryptedBytes.toString(CryptoJS.enc.Utf8);
          return decryptedMessage;
        }
      }
    })();

    var message = $("#pass").text().replace(/^"(.+(?="$))"$/, '$1') ;
    var key = $("#passInput2").val();
    console.log(typeof message);
    console.log(typeof key);
    var decrypted = code.decryptMessage( message , key );
    decrypted.toString(CryptoJS.enc.Utf8)
    
    $("#decrypted").append(decrypted);
    }); 

}); 


</script>