<!DOCTYPE HTML>

<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>

<p> enter id of message</p>

<input id="myInput" type="text" size="20">

<button id="mybutton">submit</button>

<p></p>

<p>encrypted message</p>

<div id="pass"></div>

<p>enter password</p>

<input id="myInput2" type="text" size="20">

<button id="mybutton2">show message</button>

<script>

$(document).ready(function(){

  $("#mybutton").click(function(){
    

  var id = document.getElementById("myInput").value;
  

  $.ajax({
  url: "http://localhost:3000/messages/" + id,
  type: "GET",
  dataType: 'json',
  }).done(function(data) {
   console.log(data);
   $("#pass").append(JSON.stringify(data.transit_message));
  });


  });

  $("#mybutton2").click(function(){

  var transitmessage = $("#pass").text() ;
  var key = document.getElementById("myInput2").value;
  function decrypt (transitmessage, pass) {
  var salt = CryptoJS.enc.Hex.parse(transitmessage.substr(0, 32));
  var iv = CryptoJS.enc.Hex.parse(transitmessage.substr(32, 32))
  var encrypted = transitmessage.substring(64);
  
  var key = CryptoJS.PBKDF2(pass, salt, {
      keySize: keySize/32,
      iterations: iterations
    });
  
  var decrypted = CryptoJS.AES.decrypt(encrypted, key, { 
    iv: iv, 
    padding: CryptoJS.pad.Pkcs7,
    mode: CryptoJS.mode.CBC
  })
  
  return decrypted;
  var password = document.getElementById("myInput2").value;
  var decrypted = decrypt(transitmessage, password);
  console.log(decrypted);
  };

  });

});


</script>

