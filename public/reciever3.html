<!DOCTYPE HTML>

<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>

<p> enter id of message</p>

<input id="myInput" type="text" size="20">

<button id="mybutton">submit</button>

<p></p>

<p>encrypted message</p>

<div id="pass"></div>

<p>enter password</p>

<input id="myInput2" type="text" size="20">

<button id="mybutton2">show message</button>

<div id="decrypted"></div>

<script>

$(document).ready(function(){

    $("#mybutton").click(function(){
    

        var id = document.getElementById("myInput").value;
  

	    $.ajax({
	    url: "http://localhost:3000/messages/" + id,
	    type: "GET",
	    dataType: 'json',
	    }).done(function(data) {
	    console.log(data);
	    $("#pass").append(JSON.stringify(data.password));
	    });


    });

  $("#mybutton2").click(function(){

  	function decrypt(message = '', key = ''){
    var code = CryptoJS.AES.decrypt(message, key);
    var decryptedMessage = code.toString;

    return decryptedMessage;
  
    }

    var message = $("#pass").text().replace(/^"(.+(?="$))"$/, '$1') ;
    var key = document.getElementById("myInput2").value;
    
    var decrypted = (decrypt(message,key));
    debugger;
    decrypted.toString(CryptoJS.enc.Utf8);
    document.getElementById("decrypted").value = decrypted;

  }); 

}); 


</script>